---
  - hosts: workstation-host
    remote_user: root
    tasks:
    - name: "Install open vpn"
      package:
        name:
          - openvpn
        state: latest
    - name: "Install server key"
      copy:
        src: secrets/server.key
        dest: /etc/openvpn/server.key

    - name: "install signed cert"
      copy:
        src: secrets/server.crt
        dest: /etc/openvpn/server.crt
    - name: "install Diffie Hellman key"
      copy:
        src: secrets/dh.pem
        dest: /etc/openvpn/dh.pem

    - name: "Install the ta.key"
      copy:
        src: secrets/ta.key
        dest: /etc/openvpn/ta.key

    - name: "Install the ca cert"
      copy:
        src: secrets/ca.crt
        dest: /etc/openvpn/ca.crt

    - name: "Install the tap config"
      copy:
        src: vpn/server-tap.conf
        dest: /etc/openvpn/server-tap.conf

    - name: "Enable and restart openVPN"
      systemd:
        name: openvpn@server-tap
        state: restarted
        enabled: yes

    - name: "Install the tun config"
      copy:
        src: vpn/server-tun.conf
        dest: /etc/openvpn/server-tun.conf

    - name: "Enable and restart openVPN"
      systemd:
        name: openvpn@server-tun
        state: restarted
        enabled: yes